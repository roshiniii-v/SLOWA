from typing import List, Dict, Optional
from pydantic import BaseModel, Field
 
 
class MetricPoint(BaseModel):
    timestamp: str
    service: str
    metric_name: str
    value: float
 
 
class SLOTarget(BaseModel):
    service: str
    slo_name: str
    objective: float
    window: str
    metric: str
    threshold_type: str
    alert_before_violation_minutes: int
 
 
class SLOForecast(BaseModel):
    service: str
    slo_name: str
    breach_probability: float
    time_to_breach_minutes: Optional[float]
    rationale: str
 
 
class MitigationAction(BaseModel):
    description: str
    type: str
    risks: List[str] = Field(default_factory=list)
    requires_approval: bool = True
 
 
class SLOWAState(BaseModel):
    metrics: List[MetricPoint] = Field(default_factory=list)
    slo_targets: List[SLOTarget] = Field(default_factory=list)
    topology: Dict = Field(default_factory=dict)
 
    drift_signals: Dict[str, float] = Field(default_factory=dict)
    forecasts: List[SLOForecast] = Field(default_factory=list)
    mitigations: List[MitigationAction] = Field(default_factory=list)
 
    risk_score: Optional[float] = None
    forecast_chart_path: Optional[str] = None
